/* ======================================================================
 *   Copyright (c) 2022 Texas Instruments Incorporated
 *
 *   All rights reserved. Property of Texas Instruments Incorporated.
 *   Restricted rights to use, duplicate or disclose this code are
 *   granted through contract.
 *
 *   The program may not be used without the written permission
 *   of Texas Instruments Incorporated or against the terms and conditions
 *   stipulated in the agreement under which this program has been
 *   supplied.
 * ==================================================================== */

/**
 *  \file     Cdd_Ipc_Cfg.h
 *
 *  \brief    This file contains generated pre compile configuration file
 *            for Complex device driver
 */

  /*********************************************************************************************************************
    Project: [!"$project"!]
       
    
    This file is generated by EB Tresos 
    Do not modify this file, otherwise the software may behave in unexpected way.
    
 *********************************************************************************************************************/


#ifndef CDD_IPC_CFG_H_
#define CDD_IPC_CFG_H_


/**
 * \addtogroup CDD_IPC Ipc API GUIDE Header file
 * @{
 */
 
/* ========================================================================== */
/*                             Include Files                                  */
/* ========================================================================== */
#include "Std_Types.h"
#include "Os.h"
#include "Dem.h"
#include "Det.h"
#include "ipc_notify_v1_lld.h"

#ifdef __cplusplus
extern "C" {
#endif

#ifndef DOXYGEN_SHOULD_SKIP_THIS

/**
 *  \name CDD Driver Configuration SW Version Info
 *
 *  Defines for CDD Driver configuration version
 *  @{
 */
/** \brief CDD configuration Major Version */
#define CDD_IPC_CFG_MAJOR_VERSION           ([!"substring-before($moduleSoftwareVer,'.')"!]U)
/** \brief CDD configuration Minor Version */
#define CDD_IPC_CFG_MINOR_VERSION           ([!"substring-before(substring-after($moduleSoftwareVer,'.'),'.')"!]U)
/** \brief CDD configuration Patch Version */
#define CDD_IPC_CFG_PATCH_VERSION           ([!"substring-after(substring-after($moduleSoftwareVer,'.'),'.')"!]U)
/* @} */

/* ========================================================================== */
/*                           Macros & Typedefs                                */
/* ========================================================================== */
/** \brief SPI Config ID */
#define CDD_IPC_ID                      (0x1U)

/** \brief ISR type */
#define CDD_IPC_ISR_TYPE              ([!"as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIrqType"!])

/** \brief Number of Buffers for the RpMsg*/
#define CDD_IPC_NUM_OF_BUFFERS            ([!"as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcNumOfBuffers"!]U)

/** \brief Size of each buffer for the RpMsg*/
#define CDD_IPC_MAX_BUFFER_SIZE              ([!"as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcMaxBufferSize"!]U)

/** \brief VRING Size calculation for buffer allocation in Mbox memory*/
#define CDD_IPC_VRING_SIZE                (((CDD_IPC_NUM_OF_BUFFERS)*((CDD_IPC_MAX_BUFFER_SIZE)+32U))+32U)

/** \brief Timeout value for the read/write/sync API's. Unit is in clock ticks (Default value is 5 milli seconds (2*10^6 ticks))*/
#define CDD_IPC_TIMEOUT                 ([!"as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcTimeout"!]U)

#define CDD_IPC_LOCALEP_COUNT           ([!"num:i(count(as:modconf('Cdd_Ipc')[1]/CddIpcDriver/*[1]/CddIpcEndPtConfig/*))"!]U)

[!IF "as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcSafeIpcEnable = 'false'"!][!//
[!VAR "cores"= "num:i(count(as:modconf('Cdd_Ipc')[1]/CddIpcDriver/*[1]/CddIpcRemoteCoreList/*))"!][!//
[!VAR "len" = "num:i(num:i($cores+1) * num:i($cores+1 - 1) * (num:i(as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcNumOfBuffers) * (num:i(as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcMaxBufferSize)+32) +32)) "!][!//
[!ELSE!]

[!VAR "CORE_0" = "0"!]
[!VAR "CORE_1" = "0"!]
[!VAR "CORE_2" = "0"!]
[!VAR "CORE_3" = "0"!]
[!VAR "SAFECORE_0" = "0"!]
[!VAR "SAFECORE_1" = "0"!]
[!VAR "SAFECORE_2" = "0"!]
[!VAR "SAFECORE_3" = "0"!]

[!IF "as:modconf('Cdd_Ipc')[1]/CddIpcDriver/*[1]/CddIpcLocalCoreId = 'CDD_IPC_R5FSS0_0_ID'"!][!//
[!VAR "CORE_0" = "1"!]
[!VAR "SAFECORE_0" = "1"!]
[!ELSEIF "as:modconf('Cdd_Ipc')[1]/CddIpcDriver/*[1]/CddIpcLocalCoreId = 'CDD_IPC_R5FSS0_1_ID'"!][!//
[!VAR "CORE_1" = "1"!]
[!VAR "SAFECORE_1" = "1"!]
[!ELSEIF "as:modconf('Cdd_Ipc')[1]/CddIpcDriver/*[1]/CddIpcLocalCoreId = 'CDD_IPC_R5FSS1_0_ID'"!][!//
[!VAR "CORE_2" = "1"!]
[!VAR "SAFECORE_2" = "1"!]
[!ELSE!][!//
[!VAR "CORE_3" = "1"!]
[!VAR "SAFECORE_3" = "1"!]
[!ENDIF!][!//

[!VAR "FLAG" = "0"!]
[!LOOP "as:modconf('Cdd_Ipc')[1]/CddIpcDriver/*[1]/CddIpcRemoteCoreList/*"!][!//
[!IF "CddIpcRemoteCoreIdIndex = 'CDD_IPC_R5FSS0_0_ID'"!][!//
[!VAR "CORE_0" = "1"!]
[!IF "CddIpcSafeIpcCoresEnable = 'true'"!][!//
[!VAR "SAFECORE_0" = "1"!]
[!VAR "FLAG" = "1"!]
[!ENDIF!][!//
[!ELSEIF "CddIpcRemoteCoreIdIndex = 'CDD_IPC_R5FSS0_1_ID'"!][!//
[!VAR "CORE_1" = "1"!]
[!IF "CddIpcSafeIpcCoresEnable = 'true'"!][!//
[!VAR "SAFECORE_1" = "1"!]
[!VAR "FLAG" = "1"!]
[!ENDIF!][!//
[!ELSEIF "CddIpcRemoteCoreIdIndex = 'CDD_IPC_R5FSS1_0_ID'"!][!//
[!VAR "CORE_2" = "1"!]
[!IF "CddIpcSafeIpcCoresEnable = 'true'"!][!//
[!VAR "SAFECORE_2" = "1"!]
[!VAR "FLAG" = "1"!]
[!ENDIF!][!//
[!ELSE!]
[!VAR "CORE_3" = "1"!]
[!IF "CddIpcSafeIpcCoresEnable = 'true'"!][!//
[!VAR "SAFECORE_3" = "1"!]
[!VAR "FLAG" = "1"!]
[!ENDIF!][!//
[!ENDIF!][!//
[!ENDLOOP!][!//

[!IF "num:i($FLAG) = '0'"!][!//
[!ERROR!][!//
            "When SafeIpc is enabled then atleast one remote core should be Safe enabled then only that transmission will be safe. "[!//
[!ENDERROR!][!//
[!ENDIF!][!//


[!IF "as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcRpMsgEnable = 'true' "!]
[!VAR "VringSize" = "num:i(num:add(32,text:split(as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcMaxBufferSize)))"!]
[!VAR "VringSize" = "num:i(num:mul(as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcNumOfBuffers,text:split(num:i($VringSize))))"!]
[!VAR "VringSize" = "num:i(num:add(32,text:split(num:i($VringSize))))"!]
[!VAR "VringCount" = "0"!]
[!ENDIF!]

[!VAR "IpcSize" = "0"!]
[!VAR "NotifyCount" = "0"!]
[!VAR "Offset" = "0"!]
[!VAR "FirewallSize" = "0"!]
[!VAR "SharedMemory" ="0"!]
[!VAR "StartOffset" = "0"!]
[!FOR "x" = "0" TO "3"!]
[!IF "(num:i($x) = '0' and num:i($CORE_0) = '1') or (num:i($x) = '1' and num:i($CORE_1) = '1') or (num:i($x) = '2' and num:i($CORE_2) = '1') or (num:i($x) = '3' and num:i($CORE_3) = '1') "!][!//
[!FOR "y" = "$x+1" TO "3"!]
[!IF "(num:i($y) = '1' and num:i($CORE_1) = '1') or (num:i($y) = '2' and num:i($CORE_2) = '1') or (num:i($y) = '3' and num:i($CORE_3) = '1') "!][!//
[!VAR "NotifyCal1" = "num:i(num:mul(32,text:split(num:i($NotifyCount))))"!]
[!VAR "VringCal1" = "num:i(num:mul(text:split(num:i($VringCount)),text:split(num:i($VringSize))))"!]
[!VAR "NotifyCal1" = "num:i(num:add(text:split(num:i($NotifyCal1)),text:split(num:i($VringCal1))))"!]
[!VAR "NotifyCal1" = "num:i(num:add(text:split(num:i($NotifyCal1)),text:split(num:i($Offset))))"!]

[!IF "(num:i($x) = '0' and num:i($SAFECORE_0) = '1') or (num:i($x) = '1' and num:i($SAFECORE_1) = '1') or (num:i($x) = '2' and num:i($SAFECORE_2) = '1') or (num:i($x) = '3' and num:i($SAFECORE_3) = '1')"!][!//
[!IF "(num:i($y) = '1' and num:i($SAFECORE_1) = '1') or (num:i($y) = '2' and num:i($SAFECORE_2) = '1') or (num:i($y) = '3' and num:i($SAFECORE_3) = '1') "!][!//
[!VAR "CheckStartAddr" = "num:i(num:mod(text:split(num:i($NotifyCal1)),1024))"!]
[!IF "num:i($CheckStartAddr) != '0'"!][!//
[!VAR "StartOffset" = "num:i(num:sub(1024,text:split(num:i($CheckStartAddr))))"!]
[!VAR "SharedMemory" = "num:i(num:add(text:split(num:i($StartOffset)),text:split(num:i($SharedMemory))))"!]
[!VAR "Offset" = "num:i(num:add(text:split(num:i($StartOffset)),text:split(num:i($Offset))))"!]
[!VAR "NotifyCal1" = "num:i(num:add(text:split(num:i($StartOffset)),text:split(num:i($NotifyCal1))))"!]
[!ENDIF!][!//
[!ENDIF!][!//
[!ENDIF!][!//

[!VAR "IpcSize" = "64"!]
[!VAR "NotifyCount" = "num:i(num:add(2,text:split(num:i($NotifyCount))))"!]

[!IF "as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcRpMsgEnable = 'true' "!][!//
[!VAR "VringCal" = "num:i(num:add(64,text:split(num:i($NotifyCal1))))"!]
[!VAR "IpcSize" = "num:i(num:add(text:split(num:i($IpcSize)),text:split(num:i($VringSize))))"!]
[!VAR "IpcSize" = "num:i(num:add(text:split(num:i($IpcSize)),text:split(num:i($VringSize))))"!]
[!VAR "VringCount" = "num:i(num:add(2,text:split(num:i($VringCount))))"!]
[!ENDIF!][!//

[!IF "((num:i($x) = '0' and num:i($SAFECORE_0) = '1') or (num:i($x) = '1' and num:i($SAFECORE_1) = '1') or (num:i($x) = '2' and num:i($SAFECORE_2) = '1') or (num:i($x) = '3' and num:i($SAFECORE_3) = '1')) and ((num:i($y) = '1' and num:i($SAFECORE_1) = '1') or (num:i($y) = '2' and num:i($SAFECORE_2) = '1')  or (num:i($y) = '3' and num:i($SAFECORE_3) = '1')) "!][!//
[!VAR "FirewallSize" = "num:i(num:div(text:split(num:i($IpcSize)),1024))"!]
[!VAR "FirewallSize" = "num:i(num:mul(text:split(num:i($FirewallSize)),1024))"!]
[!IF "num:i($IpcSize) < '1024' or num:i(num:mod(text:split(num:i($IpcSize)),1024)) != '0'"!][!//
[!VAR "FirewallSize" = "num:i(num:add(text:split(num:i($FirewallSize)),1024))"!]
[!ENDIF!][!//
[!VAR "Padding" = "num:i(num:sub(text:split(num:i($FirewallSize)),text:split(num:i($IpcSize))))"!]
[!VAR "Offset" = "num:i(num:add(text:split(num:i($Padding)),text:split(num:i($Offset))))"!]
[!VAR "SharedMemory" = "num:i(num:add(text:split(num:i($FirewallSize)),text:split(num:i($SharedMemory))))"!]
[!ELSE!]
[!VAR "SharedMemory" = "num:i(num:add(text:split(num:i($IpcSize)),text:split(num:i($SharedMemory))))"!]
[!ENDIF!][!//

[!ENDIF!][!//
[!ENDFOR!]
[!ENDIF!][!//
[!ENDFOR!]
[!VAR "len" = "num:i($SharedMemory)"!]
[!ENDIF!][!//

[!IF "$len > 16000 "!][!//
    [!ERROR!][!//
        "IPC Shared Memory size must be <= 16000 bytes. Reduce RP Message number of buffers or buffer size"[!//
    [!ENDERROR!][!//
[!ENDIF!][!//
/** \brief IPC Shared memory size for the selected number of buffers and the buffer size*/
#define CDD_IPC_SHARED_MEMORY_SIZE ([!"($len)"!]U)

#define CDD_IPC_R5FSS0_0_ID   (0U)
#define CDD_IPC_R5FSS0_1_ID   (1U) 
#define CDD_IPC_R5FSS1_0_ID   (2U) 
#define CDD_IPC_R5FSS1_1_ID   (3U) 
#define CDD_IPC_CORE_ID_MAX   (4U)

#define CDD_IPC_MAX_ENDPOINTS_PER_CORE (64U)   

#define CDD_IPC_MAX_NOTIFY_CLIENT_ID_PER_CORE (16U)

/**
* \brief Maximum value of message that can be sent and received when CRC is enabled.
*/
#define CDD_IPC_NOTIFY_CRC_MSG_VALUE_MAX (0x100000U)

/**
* \brief Maximum value of CRC that can be sent and received.
*/
#define CDD_IPC_NOTIFY_CRC_MAX (0x100U)

/**
* \brief CRC size in bytes for IPC Notify.
*/
#define CDD_IPC_NOTIFY_CRC_SIZE (1U)

/**
* \brief Data size in bytes for IPC Notify.
*/
#define CDD_IPC_NOTIFY_CRC_DATASIZE (4U)

#define CDD_IPC_RPMESSAGE_CRC_SIZE (2U)

/**
 *  \name Pre-Compile Switches for API Services
 *  @{
 */
/** \brief Enable/disable CDD get version info API */
#define CDD_IPC_VERSION_INFO_API                                  [!IF "as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddVersionInfoApi = 'true'"!](STD_ON)[!ELSE!](STD_OFF)[!ENDIF!]
/** \brief Enable/disable CDD dev detect error */
/* Requirements:  */
#define CDD_IPC_DEV_ERROR_DETECT      [!IF "as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddDevErrorDetect = 'true'"!](STD_ON)[!ELSE!](STD_OFF)[!ENDIF!]
/** \brief Enable/disable CDD deinit API */
#define CDD_IPC_DEINIT_API                                        [!IF "as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddDeinitApi = 'true'"!](STD_ON)[!ELSE!](STD_OFF)[!ENDIF!]
/** \brief Enable/disable CDD  Write API */
#define CDD_IPC_WRITE_API                                         [!IF "as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcWriteApi = 'true'"!](STD_ON)[!ELSE!](STD_OFF)[!ENDIF!]
/** \brief Enable/disable CDD Read API */
#define CDD_IPC_READ_API                                          [!IF "as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcReadApi = 'true'"!](STD_ON)[!ELSE!](STD_OFF)[!ENDIF!]
/** \brief Enable/disable CDD RPMsg APIs */
#define CDD_IPC_RPMSG_ENABLE_API                                  [!IF "as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcRpMsgEnable = 'true'"!](STD_ON)[!ELSE!](STD_OFF)[!ENDIF!]
/** \brief CDD register readback functionality API */
#define CDD_IPC_REGISTER_READBACK_API                             [!IF "as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddRegisterReadBackApi = 'true'"!](STD_ON)[!ELSE!](STD_OFF)[!ENDIF!]
/** \brief Counter ID for counter used to count wait ticks */
#define CDD_IPC_OS_COUNTER_ID               ((CounterType)[!IF "node:refexists(as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddOsCounterRef)"!][!"node:name(node:ref(as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddOsCounterRef))"!][!ELSE!][!"as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddDefaultOSCounterId"!]U[!ENDIF!])
/** \brief CDD Rpmsg Recv Callback Enable Switch */
#define CDD_IPC_RPMSG_CALLBACK_ENABLE                             [!IF "as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcRecvCallBackEnable = 'true'"!](STD_ON)[!ELSE!](STD_OFF)[!ENDIF!]
/** \brief CDD Rpmsg Recv NOTIFY Callback Enable Switch */
#define CDD_IPC_RPMSG_NOTIFY_CALLBACK_ENABLE                      [!IF "as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcRecvNotifyCallbackEnable = 'true'"!](STD_ON)[!ELSE!](STD_OFF)[!ENDIF!]

#define CDD_IPC_SAFEIPC_ENABLE          [!IF "as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcSafeIpcEnable = 'true'"!](STD_ON)[!ELSE!](STD_OFF)[!ENDIF!]

#define CDD_IPC_CRC_ENABLE              [!IF "as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcCrcEnable = 'true'"!](STD_ON)[!ELSE!](STD_OFF)[!ENDIF!]

/* @} */
[!IF "as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcRecvCallBackEnable = 'true' and as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcRecvNotifyCallbackEnable = 'true'"!][!//
    [!ERROR!][!//
        "Either recvNotifyCallback or recvCallback can be configured for any given local End point."[!//
    [!ENDERROR!][!//
[!ENDIF!][!//

/** \brief Symbolic names for the Cdd Ipc Local End points for better indexing */
[!LOOP "as:modconf('Cdd_Ipc')[1]/CddIpcDriver/*[1]/CddIpcEndPtConfig/*"!][!//
#define CddIpcConf_CddIpclocalEndPt_[!"@name"!]   [!"@index"!]
[!ENDLOOP!][!//

#endif /* DOXYGEN_SHOULD_SKIP_THIS */

/* ========================================================================== */
/*                         Structures and Enums                               */
/* ========================================================================== */

/**
 *  \brief This type defines a range of specific status for Complex driver
 */
 /** Requirements :  AUTORADAR_MCAL-70 */
typedef enum
{
	/** \brief The Complex Driver is not initialized or not usable */
    CDD_IPC_UNINIT = 0U,
    /** \brief The Complex Driver is not currently  writing */
    CDD_IPC_IDLE = 1U,
    /** \brief The Complex Driver is  currently open */
    CDD_IPC_ALLOW_ACCESS = 2U,
    /** \brief The Complex Driver is performing a Write*/
    CDD_IPC_BUSY = 3U,
    /** \brief The Complex Driver is  currently open */
    CDD_IPC_CLOSE = 4U,
       
} Cdd_IpcStatusType;

typedef struct Cdd_Ipc_RPMessage_EpObject_s {
    uint32 rsv[192U/sizeof(uint32)]; /**< reserved, should NOT be modified by end users */
} Cdd_Ipc_RPMessage_EpObject;

typedef void (*Cdd_Ipc_RPMessage_lld_recvCallback)(void *handle, Cdd_Ipc_RPMessage_EpObject *obj, void *arg,
    void *data, uint16 dataLen,sint32 crcStatus,
    uint16 remoteCoreId, uint16 remoteEndPt);

typedef void (*Cdd_Ipc_RPMessage_lld_recvNotifyCallback)(void *handle, Cdd_Ipc_RPMessage_EpObject *obj, void *arg);

typedef sint32 (*Cdd_Ipc_CrcHookCallback)(uint8 *data, uint16 dataLen, uint8 crcSize, void* crc);

typedef struct
{
    uint32 Cdd_Ipc_localEndPt;
    Cdd_Ipc_RPMessage_lld_recvCallback recvCallback;
    void *recvCallbackArgs;
    Cdd_Ipc_RPMessage_lld_recvNotifyCallback recvNotifyCallback;
    void *recvNotifyCallbackArgs;
}Cdd_IpcCreateParams;


typedef struct
{
    uint32 Cdd_Ipc_SelfCoreId;
    uint32 Cdd_Ipc_numCores;
    uint32 Cdd_Ipc_coreIdList[CDD_IPC_CORE_ID_MAX];
 	#if(CDD_IPC_RPMSG_ENABLE_API == STD_ON)
    Cdd_IpcCreateParams Cdd_Ipc_RpMsgParams[CDD_IPC_LOCALEP_COUNT];
	#endif
    Cdd_Ipc_CrcHookCallback Cdd_Ipc_CrcHookFunc;
  
}Cdd_IpcConfigType;

[!LOOP "as:modconf('Cdd_Ipc')[1]/CddIpcDriver/*"!]
/** \brief Cdd Configuration struct declaration */
extern CONST(Cdd_IpcConfigType, CDD_PBCFG)[!"@name"!]; 
[!ENDLOOP!]
extern P2CONST(Cdd_IpcConfigType, AUTOMATIC, CDD_PBCFG)CfgPtr;
/* ========================================================================== */
/*                          Function Declarations                             */
/* ========================================================================== */

[!IF "as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcSafeIpcEnable = 'false'"!][!//
[!IF "as:modconf('Cdd_Ipc')[1]/CddIpcGeneral/CddIpcRpMsgEnable = 'true'"!][!//
void Cdd_Ipc_VringMemAllocation(void);
[!ENDIF!][!//
[!ELSE!]
void Cdd_Ipc_SafeIpcMemoryAllocation(IpcNotify_MailboxConfig *mailboxConfig);
[!ENDIF!][!//

#ifdef __cplusplus
}
#endif

/**
* @} 
 */

#endif  /* #ifndef CDD_IPC_H_ */





